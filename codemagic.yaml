workflows:
  default-workflow:
    name: Default Workflow
    environment:
      vars:
        XCODE_WORKSPACE: "BMI Calculator.xcworkspace" # <-- Put the name of your workspace here.
        XCODE_SCHEME: "BMI Calculator" # <-- Put the name of your scheme here.
        BUNDLE_ID: "com.souvik-biswas.BMI-Calculator" # <-- Put your Bundle Id here.
        APP_STORE_CONNECT_ISSUER_ID: Encrypted(Z0FBQUFBQmhIR1hjb2VuZlNUZ09VUHdONnBpUzdiZnFYal9ydlpPVzV5cWQ5MEtRUlFIYnlFUjd0eEZIWUpPamxxMTNERFU4WVB1alRnTHZscmtLYTUtRVE2RTZYY1gyS0E1WFR4M0FMWWYyeHltWW82SDh3c2NwNWtLZVZ6SEhucEJnVjcwMF84YnQ=) # <-- Put your encrypted App Store Connect Issuer Id here
        APP_STORE_CONNECT_KEY_IDENTIFIER: Encrypted(Z0FBQUFBQmhIR1lfOTZ4TW03QVlsSWtCZmRMWVFRczA2ZUNwVzgzdTRkRTkydnRkMDhKRV8ySTJORWEyZUpzWV9PUHlLcGROWVN0aGRUVXR5dU9jdlozb1NrZDFLR09XdlE9PQ==) # <-- Put your encrypted App Store Connect Key Identifier here
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhIR2FpM0lFOWJJVVVkLWhXZWFiRm45T0VQcWg5Tk5ieDZJUTBSWDlOeGpNWGtCRlc5bnp0UHFmdkdFVTNMYW9zNWM1WkN1M01vajM5S04ySDhxOHZobjVIVFljTndZdTk3dFBmUmhJWExMTW1vSFR4NXJZVjc5VXdVRFpVSDBsd1hSdkl2YmM1aVoyTFJ1WE5fZzhKdFl6ekoxM0ZKUnkwbFVlRGNrQ2ZiUmFiMnNKRHRabHlsWWdYenFXckNIRjlTZmkzQ2JmZkhnZk5TQ1dUN1AzY0JTdWtVMFlmQVpEdjNGQW9RSUFFMWxDUzRmb3RmSUNXaWt0d0ZCUnB6aUtsUFBGU1AwcmJUeEUyZFpYQzBNb05iU3ZhR09wa19MZXl6VFpLSlRpRkNtaW5UQWM2UnpLeUx2TWRTdzliZl9LSzR0X2M4clBlRmdsaHRFNXpHenZWSXI4RUk2VUdhamE2a0FYaUM0UnplX3lzUEpTRjUwQXoyUGpTNTR1VENmcTV5d2hkMmtRRFBiS3J4cEhjNlVsT0ZPV2xyZ3dma2RjUW1HRDZBTTRJdmFBVjVFaz0=) # <-- Put your encrypted App Store Connect Private Key here
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhIUnktREh6UTI0TURhQTJXd0NDeUx3WDFTVnpTbHA1MTE5Uk5Pa1Y5RUo1dWUwX0J4dmNVakx5UFVlVlYwSmlhZ1VxZVhzZjNJNnlLbTNyUXE5VjJPY25iNFpTb2dRNEJMWDlWRWd4Qmh6VktGNFZvMHRZRlMzSk83UVloT2pDQS01Sy1OYjhWZGJVcEpSVFN4R3ZtT1VHMncwY21FbVpDUXgwcHVYajFDc2tEZUsxVGdIMi1FNVU3cUZHS1NIRTR2cmwta3V4TUJpM2VSbjBvd29jTmdIazBNVTFfSWJ3cjZHLU8zTjFnZG9KUmhBVUtUMWJsWS1YTXhLajhOaV9HZXhsTzNFS1U1eGp4ay1ELWlKNjM3YkhPSUY3Sm5EekIyTnB1bWMtWEYxYVkzZGF4bjlYMGllNG5PT2pYc1JiMzdybFlfNkhWR01EcFVEc3RaVy0wN0pIVVJMR3FsSUxVQmt3enpsZkdYZ2ZKTUdHS20zQ09mdlJ3cVZJOTJxdW8xSkRlcDhFeldreFQ3OGQ1REg0Y3NScUJRNHJ4VGstQjlDWEh1ejdpU2FsM3FYbVh5cVFOdzNaUTJ4b25WMkpTUGpiYWpnb1BNdmpjWXBzcTVybHd6TGtNZ0JvOFpVZE5mcXJNbHk2ZFRtaHgxblJ4cWJUUkpEWTd3WG5CbmdnTTg5RVNtbERNVzFGSTAzS1Zxa2FqTW92NjRobDNZZXJDVnRheUZ1b1JMdDhOc0VRZXN6V2NMWloxYzBMTXliODZhR2ZaN2NSSVlsdTBUV0VBQTVzQU5Ma3JpSV9OM2VCNVF6VlNBN3M5bzV3bU1DRzV0dUJ2NG54dlRoYkc1U0RMc3FNR2ROMU9ZYWQ2ek9nSUhBUTBnYmgyWWxuRGpQcUt0dWoxMmtHWHBOSzJFejdtY0Q2dlZwMHBLeXhKSk9LQmVxQnhIdmN4RzBlN0ZiejZia3l2WXZfcV9BY3JiQzdGTmFfNDRadzBZNWhfRC1mSE95OWVtSUNtZ0hsWUttMTVWak5FQVBXLTlIRHl3MVI1RWI1MHlobERBYzBNT19zZHFMNkVNdXdLVGM1NVFtNUpCVG8xYW45R2U5a1lSdlJXUGd3UFlqVndwcFVsa0YzNHU2M2gxLXRZOUQ3blotVUFHQ1RnbjdWY0RfWVpQRVZVSXJyUnFfczJZTkF5eVRPM1VWaTdCMTNCZkZLYnJWRVFMRkZkTVFrUEJuTi0wcks3UEZtcUNPQm5mbDhnWUFnVy1mZllkZDJkM25YYnd3QWxkaEtjOHh4MWJPRTZFa2ZIRTB5aFZCUFhCTVY0cXM3Q0YtWnhLX2h1UnRSS2kyNDAzTHVkdGdFTFR4YkxPLWZ2U19QSlV5MGEySGJzQ2JvaXRhZVVMemUtc3FiTEtqT0dKR0JHUXY4OUV3R01UdHhfaVBYVXlXNENQQ0JnQ2dGQ0gwaDVyeFBwdFRqMmRKR3NTTVk4SEpXNlB3RU9MVldMVWZRcjM4Y01LZkgxOEUwQk5sMHBtNW5UVmRFdzUwN2M0RXlHRjZWS0VQZkFDc0NQb3RyVFNNVUc5NEVvdXNXV0pfRWdzWkJ0MTRQUjZZblE1bnVDcWJjZkxESm5xV2pwdnJkUmNOaGRHTEwteEZwQmxDTnZnamY1QU00aDBFWUdQVDBJeHRldmE4QmZzLTZDYXhEbTZyT0lFemZ6cEVpNnV6eksyT3NQOFhOMEQxR1NHa1E5QlZNVlp4UnM2QnFSVTRKTm1RUlZvZkczTC1PN1pqaWVOU2hvb2hnZVhzbEZla1ZHaHBWcnJJQjFNX19FVjVqV3pNS0JaNTRRQU5qS0Ric0xNTy0wemRzaUtPMW1UY0RfdWgwMEdmbW9iR2MxWktLQWlpNk8xQkI4NmJ0RFZsS19vNS1qaUdKRTZwa1lPYTU5S2toQjFGNWRnZHYxSkZCaUxGWUllUHpJTGlQbFNJSkxmbFlEV3Q2V2l1M1g0RDBTYjlFeHZ5Zk9XYmd1V1VyNWsxNVNxSTk0NTlDRUxxbkN1NUlUb1JHYlRHUVB0Z3QxTk9XLWNvV2w4OGgtd1BmM0t4bWN2QkgxcWZlTTdROG5mY21fQ2MwOXE2bGwxd2F1WmNJZGItbDVGQ29rbWw3UUNjTHJQM2JJUUdhbUV3QThlVVNvTVFsU3BENmVsWFppXzRpNkFxTFVkUU00ZDVObTBpRlhNVUR6X0Z5TUZwNHlteV9zVXFYNjZabkpILTU3cjZDdEg1U1ZCU2RqOVBkQnptSThlYjI2TkM1LUl6bFlSeDVwd09xMVBCWjB2Q3diV1hBR25GUGY2T2hxWnd3SUZITnJLN2NaaXdmNEJhOXF6NzJXbGRXU3RDR05lNzdNT3dGNjZfanQ2Wm5fX2ZYRzFHbnJZYk1pVmFGY3U0NUVfcHhBNE0xTUxfcTVMMko5blc5TFhoaWJLUFJmdEZBYXlqSUEzSEl5b2VHanRiVzZSRnNBem1haXdZODhmdGl6RnRZZV9vQkE1eWpWcVhKNHl1bTFfNm9qSVBYdm1mSjZaTmVGMGFRRGx1UFYxRjhyaElPZGhITldleU1OaS0ySUVYUnUxN29CSXUwam80YUVOZnJuaHNzRHlfUnFQNVVVZng2U0MwUXRPeWYyeDVmLXRBSWlzeFQ0LUM2M041elVJX0xkQUVmTGpmVUNPaDJRU3JEWGUyb0hkbUZDZXZOZ1N2QzJpVjVkQk1fbERoQS1SVndoU0QxdHNSMWNkR05QdnFfaDgwcjBEMkNrRy15UlI5OVFQYXUzNU44MmxhSHgwQ3QtSm1pbUZiYVJ3ZktWQWVUcmxORVFNT1Z2QWhCMEtiWHEtQnJyM0J2TVNmeF9KZ0FuT1RtVV9ST2RFNUZEcGc3ZzFlNldtTzdrU2FtYnBjX2VTUGNLSURUM01YQnZGcXdUQUE0VjduYkdneHZQY1NxMXVJZWN0emVHV25GVU1aMWFzLTVpRWpWNGY0bUpVYmNRQld0M1hOTmlURjllR2VDd1NOT2RuNVZnSWEtWXFzUFBjTjNRY195UEcwaFo5UUVaby1WS0hBRlVWRUk5) # <-- Put your encrypted Certificate Private Key here
        APPLE_ID_EMAIL: sbis1999@gmail.com # <-- Put your encrypted Apple Id email address here
        APP_SPECIFIC_PASSWORD: Encrypted(Z0FBQUFBQmVZbW5ZSVAxaDJOSVVWaGl5bnhoajdMZU9VNmNBcFFvd0cxZDEweUUxcFBsWVpoTi1xLWczbzJWTkkybURXVlJoY25TVDlUQmRidC1QQ3ZFa0Fkd3RRbGdway1xMk9hTGNGMmx0ZmVvbXR6MG9lQnc9) # <-- Put your encrypted App Specific password address here
        FLUTTER_DIRECTORY: bmi_flutter
        IOS_DIRECTORY: BMI\ Calculator
      flutter: v1.12.13+hotfix.8
      xcode: latest
      cocoapods: default
    scripts:
      - name: Get dependencies
        working_directory: bmi_flutter
        script: |
          flutter packages pub get
          find . -name "Podfile" -execdir pod install \;
      # - name: Test Flutter app
      #   working_directory: bmi_flutter
      #   script: flutter test
      # - name: Build Flutter app
      #   working_directory: bmi_flutter
      #   script: flutter build ios --release --no-codesign
      - name: Set up keychain
        script: keychain initialize
      - name: Fetch signing files
        working_directory: BMI\ Calculator
        script: |
          app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create
      - name: Use system default keychain
        script: keychain add-certificates
      - name: Set up code signing
        working_directory: BMI\ Calculator
        script: xcode-project use-profiles
      - name: Increment build number
        working_directory: BMI\ Calculator
        script: |
          #!/bin/sh
          set -e
          set -x
          agvtool new-version -all $(($BUILD_NUMBER + 1))
      - name: Build ipa for distribution
        working_directory: BMI\ Calculator
        script: xcode-project build-ipa --workspace "$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME"
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - sbis1999@gmail.com
      app_store_connect:
        apple_id: $APPLE_ID_EMAIL
        password: $APP_SPECIFIC_PASSWORD
      # app_store_connect:
      #   app_id: com.souvik-biswas.BMI-Calculator
      #   apple_id: sbis1999@gmail.com
      #   password: Encrypted(Z0FBQUFBQmVZbW5ZSVAxaDJOSVVWaGl5bnhoajdMZU9VNmNBcFFvd0cxZDEweUUxcFBsWVpoTi1xLWczbzJWTkkybURXVlJoY25TVDlUQmRidC1QQ3ZFa0Fkd3RRbGdway1xMk9hTGNGMmx0ZmVvbXR6MG9lQnc9)
