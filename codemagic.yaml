workflows:
  default-workflow:
    name: Default Workflow
    environment:
      vars:
        XCODE_WORKSPACE: "BMI Calculator.xcworkspace" # <-- Put the name of your workspace here.
        XCODE_SCHEME: "BMI Calculator" # <-- Put the name of your scheme here.
        BUNDLE_ID: "com.souvik-biswas.BMI-Calculator" # <-- Put your Bundle Id here.
        APP_STORE_CONNECT_ISSUER_ID: Encrypted(Z0FBQUFBQmhIR1hjb2VuZlNUZ09VUHdONnBpUzdiZnFYal9ydlpPVzV5cWQ5MEtRUlFIYnlFUjd0eEZIWUpPamxxMTNERFU4WVB1alRnTHZscmtLYTUtRVE2RTZYY1gyS0E1WFR4M0FMWWYyeHltWW82SDh3c2NwNWtLZVZ6SEhucEJnVjcwMF84YnQ=) # <-- Put your encrypted App Store Connect Issuer Id here
        APP_STORE_CONNECT_KEY_IDENTIFIER: Encrypted(Z0FBQUFBQmhIU0I1QlROZ0pEZjBYOVJ4STltRDQyOGdfUHJySElYU3N2bjFSdkhMRUxRZzVodVJ2NnY2TmliYXRCcTZrcEQxb3VoUEZwQ1VPVWJ1SWlOa1dkUTV5REFRWWc9PQ==) # <-- Put your encrypted App Store Connect Key Identifier here
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhIUi01b3RqcnpVYWhIZkdfSWRpeWt6RTdEdkFGU3RYbGRvUm9HVzNkcHd4WkJseVFsRDBNZXJDUEJGbTRKVV9ZR0ZzaDVuZk9zMUlJNEVzQUQzTDktU0JzODhrdGZfLXpGZ1BDczUwUERjQ1d6M0x4NHBfZ1JRc3dUU28yWEI4dFlYeDFHUi15MU9SZEJrNWVUR1Qtc1NiRkVGTTVXTmV3WXd5TVAxVEQ0Z1U2V2QzQ1FLalRsT3hLMlItdFdyaUdUX3lqeGhpc1R0emRfMzV3VE9JRUxEV3lUWHdmRVZhV1dtb2Q1VDdXakpYV2NMYllfQWtkSEV1M09HYVhvRnBTZ0Q3eTVTdl9oUjFrX01aMUxCQVpjcnhWWGNTeTdBSnBnWkZSWk9mQm5rMGtOS0owd2o3NUktX2ZuYUlJZmV1dlhMRjNsMmQ3d1FJYUw1c2VMVDFnWmNVYlY2eUd0aDN5LWF3aTNBRElCZFNTa2FwVkF0YnFXRzJNLUVqLXhHRGpyYlREbjEtNVRMRThaV0lQMk1sZ1NlNmFocXJFTjdUNW5YSUJPdG5tY3laTkFzOD0=) # <-- Put your encrypted App Store Connect Private Key here
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhIU0FDd2JuZlFUa0N3RTFtOFl2MDVvWVFxbkhkWXBMZFJNUnRVWk9mZ1BoQWVia0IyWDJwV055d1YtV2lVV2dibTB2UXpNVE00MU5MOWJxYXN5SkZhTWxwWC1OQUJ4NFU3SDdMdmNQRnIzWkhOcXM2aHFJOVFzV1R0REU5NWxWaFc3ZldpUC0zMzhodlMyRG9IcXQzSWY3RXh1RFMyUk52OUw1OW9ydkFvQjA0YkVOakhWYm9EdzRMdFJpU2UxcTUyWTEyajVkNG9SUG45MFB4dEk3UmE4RDV6M2JKbXBOQ0JGeTl6NW1MYVktazl0Ui13elk5dGdUUHVhSjd6TEM0NzJfZ1E5ZFYyT2FrZW8xcFYydjNnYnJ4WXgyNkw4WFBnTmdQQjBqTVdNNHk3eWJJQ3VwV2pXYjRKUkxtUWxxS295NW8zRUtJZ1RtNlJxU042dDlwWHFNUnFoQlJZemRWV0NzWmhPbkwwbUdZZkJ4RG1nT1NMaVNqNmFsa0lZNm9LQ1hPSmZOVm9UYV94RnppMkFFOUZKTE5ZZGFDbGhYT0RDazRuWkhBR2RLRUxVbjdTMzlWVUw1ZllhVjdfa0JlTUc1VWZyZmFWN2FmWWMtVFlhYVFvSy1fYUNkSUVtcnF5ZTBTczlsWHZSY1V4UlBjTkJ5ZElwenJtLUxWb0wtMXh5NVRXOTlHdVdiMTRBdXJRVk1zRGtIZmd1MnRGczV4Z0NDYzBEYmhwQlpTTnJOZU1rSGVLQURZdElmUm5YMnphODdBaHJCMy1OUy1EYlNFSGd4NUcwUXBzWkRoVGx0a1FGY1FFWUh5MFJFUDBfUlBSMkxMaUZYWDVkck00WnhFSDlDakpvZ0p0T21vSE5qcWMtdnV4MHV2UUI2WmYzYkhKU0pMTV9IclhHTDBWRFBrZ3VpamlqS3ljRERsLUlpMVBSZ2ZRaU02WW5ENkw3UVNyel9kaXZ0aS0tSWdMekp6S1FDMzFDUExpb2FNR3NJQlQzZFFVQzFESW1NcUxkb1doZVVkLXdnbW1RbnFlR0tZbDVBSi1PNWdVV1ZpUzY0ZzB5b3FVbjM1bkNGenRZVGNfZE92TDNHVVpFWXpPcmZWZ1pPSm1SWWhvZnd1eEg0azRIR2FfMWtTSEFFbThTOGNQZ3FNQUFkLW85SHRjVVUzcUgtenpSWnJFMUJZZHhiRVJuZHEwWDRxMkR1eG5KWnhXOHRwUFpBOUxzTk45VHhnb0Z4VHNRb3hVbERVZG4tNENEYWRuU2t6OUdGQ1B3dVdUZGZ3QjM1dFJ0Vkp4dlVKTDBqcjFWRnRSUnplVWoxQVZTRUI5MVNKbVZrOHgtdTNWSmlwaFhGZU51RG15czBvaGFXOWswc0lra2NIVDVYbVdBVk9fbUJXczBmcVdLeHp5alJWMFBvek9ncVN6MHgxYU9jSXNXaWYzMHkwc2pLbUlYbHhDUEZMdGxUTG5zYkljaV9hdlRCb0puOHRfS2RYcmdZVGtsTVpQajRVY2VaQUhVbHNjeEsxNVVoV3dQTmdsVDBoSGdBWmtHbTU3dS1xd25ZeHdGbHpCbkRXTEZXMWR6c09yaFhzRFdpckVmY2hKdkxyMm5DZFZZRnBrVGxKd2h6YnBGTlZmeXc1R3liRkNVU1J6NmpicExqamRiUmhBRVRwcEkwblEybTktbm5KM09oejBpb0hQSnhsZVQ4NHdYaEhkTmJxc0F1S08zbmg3TWNYLWtZc3VFbXdmRl90ejlGUVQ0NVRsM2J0WThKelBfWTVoeno5SzNpVjNNUE5yXzQ4UGNSSFd1U3JMMG1UZnJEUmF3TmZxRjU4LWFTZkVsQk9DcDZWbUxRV3JLNmQtSkdsYTc0bUt4d0FkTjFTcTNSYXliYk5ZSUFXdDF4TElwYkFKX0YxMWY4Ql83TFFZeTl0bHp5d0ZyRnhjVEQ2WXkteENHeEdMRnRhcEx6RHFTbVBmc25vcEVqY3RfN0E3WHpIM1cwd3dZSS1XX2I5UmNJQTNlb2JwVGNNTGFON3l4dk11amVZS1A1ZS1fcktaZi0wbk1OSi1SdE5leU4tTmtld2M2V2hKR0d0WUpqaDZ3WlpyU1RIdkgwWU1WeFJYVVl5NjdocmdJaFNvUVB6UlZBZW5zZWFtVnpQNVdsZ3BuU0hfc2hrYTVqZkg3U0REbTVjbWg1VFZsTWd6UGhlVW1EaU5UN0J2WHY4bHM0M2RuNmdMSWI4cks5akpFZGpVWWdzcWhCNGR2QTdHY0s0dmplSUVYNlJqQkc5V2J6Ykk4SEJhSFB6OGV2RWtBd18xbnNfaGhHOVowdktseU5TdVg3ODNNUWdsejd0M2h4TkNSVU5HOW93Tk1zWGVUcnRJV0ZfTXBwSkRJdzY5S1d2ak9hRXVDQnBfdFJoUEZ0MTBxLVRCYnJZSGV4SHlVSUdRMm5jQlRVWDFzUzJleHFPanBXeTFOM3J5LXlzMl9MSHVNU3d5QUVQWXdzQllqS1gxdENpQmNKM2stS0taaE44bU12bThscVJZWTVVQzVlVEZuYXZURUE0V0RBUDZTQ092WWNhajBYanJPazZqNVJKVVBJQ0t0MnJOdzR5aHVPTG9NMzZfVEZkaUMzUTBtd08xVzhSMnpjUVhZUGxjZVFEd3NJZ1hOQWRPdzJMalJRTUNBWmdvUkxkMm9SVF9RNjdxajQ3cENETW9Hdkc3V0lxUWthdkllRUp1YzBGZVMxcGRYbGRxNFlOOUtXekVLM0g1NUtXTlZhcFE0VFMyZDdQNmRZbEF0LWctZEpDR0QySHltbzdtaDlpN1Y0VEJBQ2NvengtaF80RE9BQ05PUUtMSDVRbUNvLWZkM1ptcUxEbHNBd3pXRjNObFdxYjdLYWc0bllLTnlWOTNBb0dvY1JsMlZaWnBaUWtaMW1vSGozcVk1d2sxdGZTdDQzLXNxSXlUcEpHdHJtTmVEX0VNOWZDOENUVzVsOE5QcE1MS05udGNSZ2E3REpfMGF6QUU2dzNLVWFVSlNvUjlDVkJqMjdxcGstMHlmUm53R3BwamJqTVFCM1dFb1pMWksyMW5ybC1YcFhw) # <-- Put your encrypted Certificate Private Key here
        APPLE_ID_EMAIL: sbis1999@gmail.com # <-- Put your encrypted Apple Id email address here
        APP_SPECIFIC_PASSWORD: Encrypted(Z0FBQUFBQmVZbW5ZSVAxaDJOSVVWaGl5bnhoajdMZU9VNmNBcFFvd0cxZDEweUUxcFBsWVpoTi1xLWczbzJWTkkybURXVlJoY25TVDlUQmRidC1QQ3ZFa0Fkd3RRbGdway1xMk9hTGNGMmx0ZmVvbXR6MG9lQnc9) # <-- Put your encrypted App Specific password address here
        FLUTTER_DIRECTORY: bmi_flutter
        IOS_DIRECTORY: BMI\ Calculator
      flutter: v1.12.13+hotfix.8
      xcode: latest
      cocoapods: default
    scripts:
      - name: Get dependencies
        working_directory: bmi_flutter
        script: |
          flutter packages pub get
          find . -name "Podfile" -execdir pod install \;
      - name: Test Flutter app
        working_directory: bmi_flutter
        script: flutter test
      - name: Build Flutter app
        working_directory: bmi_flutter
        script: flutter build ios --release --no-codesign
      - name: Set up keychain
        script: keychain initialize
      - name: Fetch signing files
        script: app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create
      - name: Use system default keychain
        script: keychain add-certificates
      - name: Set up code signing
        working_directory: BMI Calculator
        script: xcode-project use-profiles
      - name: Increment build number
        working_directory: BMI Calculator
        script: |
          #!/bin/sh
          set -e
          set -x
          agvtool new-version -all $(($BUILD_NUMBER + 1))
      - name: Build ipa for distribution
        working_directory: BMI Calculator
        script: xcode-project build-ipa --workspace "$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME"
    artifacts:
      - BMI Calculator/build/ios/ipa/*.ipa
      - BMI Calculator//tmp/xcodebuild_logs/*.log
      - bmi_flutter/flutter_drive.log
    publishing:
      email:
        recipients:
          - sbis1999@gmail.com
      app_store_connect:
        apple_id: $APPLE_ID_EMAIL
        password: $APP_SPECIFIC_PASSWORD
      # app_store_connect:
      #   app_id: com.souvik-biswas.BMI-Calculator
      #   apple_id: sbis1999@gmail.com
      #   password: Encrypted(Z0FBQUFBQmVZbW5ZSVAxaDJOSVVWaGl5bnhoajdMZU9VNmNBcFFvd0cxZDEweUUxcFBsWVpoTi1xLWczbzJWTkkybURXVlJoY25TVDlUQmRidC1QQ3ZFa0Fkd3RRbGdway1xMk9hTGNGMmx0ZmVvbXR6MG9lQnc9)
